<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <title>Navigation Guards</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="../../../../../css/ionic.bundle.css" rel="stylesheet">
  <link href="../../../../../scripts/testing/styles.css" rel="stylesheet">
  <style>
    .toolbar {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 100;
      width: 200px;
      background: white;
      box-shadow: 0px 1px 10px rgba(0,0,0,0.2);
    }
  </style>
  <script src="../../../../../scripts/testing/scripts.js"></script>
  <script nomodule src="../../../../../dist/ionic/ionic.js"></script>
  <script type="module" src="../../../../../dist/syg/syg.esm.js"></script>  <script>

    class HomePage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <syg-header>
          <syg-toolbar>
            <syg-title>Home Page</syg-title>
          </syg-toolbar>
        </syg-header>
        <syg-content class="syg-padding">
          <syg-list>
            <syg-button id="router-push">router.push</syg-button><br>
            <syg-router-link href="/child/1">
              <syg-button id="router-link">syg-router-link</syg-button><br>
            </syg-router-link>
            <syg-button href="/child/1" id="href">href</syg-button>
          </syg-list>
        </syg-content>`;

        const childButton = this.querySelector('#router-push');
        childButton.addEventListener('click', () => {
          const r = document.querySelector('syg-router');
          r.push('/child/1');
        });
      }
    }

    class ChildPage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <syg-header>
          <syg-toolbar>
            <syg-buttons>
              <syg-back-button default-href="/test"></syg-back-button>
            </syg-buttons>
            <syg-title>Child Page</syg-title>
          </syg-toolbar>
        </syg-header>
        <syg-content>
        </syg-content>`;
      }
    }

    class TestPage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <syg-header>
          <syg-toolbar>
            <syg-buttons>
              <syg-back-button></syg-back-button>
            </syg-buttons>
            <syg-title>Test Page</syg-title>
          </syg-toolbar>
        </syg-header>
        <syg-content>
        </syg-content>`;
      }
    }

    class GuardInitialPage extends HTMLElement {
      connectedCallback() {
        this.innerHTML = `
        <syg-header>
          <syg-toolbar>
            <syg-buttons>
              <syg-back-button></syg-back-button>
            </syg-buttons>
            <syg-title>Guard Initial Page</syg-title>
          </syg-toolbar>
        </syg-header>
        <syg-content>
        </syg-content>`;
      }
    }

    customElements.define('home-page', HomePage);
    customElements.define('child-page', ChildPage);
    customElements.define('test-page', TestPage);
    customElements.define('guard-initial-page', GuardInitialPage);

  </script>
</head>

<body>

  <div class="toolbar">
    <syg-radio-group id="beforeEnter" value="allow">
      <syg-list-header>
        <syg-label>
          beforeEnter Behavior
        </syg-label>
      </syg-list-header>

      <syg-item>
        <syg-label>Allow Navigation</syg-label>
        <syg-radio value="allow"></syg-radio>
      </syg-item>

      <syg-item>
        <syg-label>Block Navigation</syg-label>
        <syg-radio value="block"></syg-radio>
      </syg-item>

      <syg-item>
        <syg-label>Redirect</syg-label>
        <syg-radio value="redirect"></syg-radio>
      </syg-item>
    </syg-radio-group>

    <br><br>

    <syg-radio-group id="beforeLeave" value="allow">
      <syg-list-header>
        <syg-label>
          beforeLeave Behavior
        </syg-label>
      </syg-list-header>

      <syg-item>
        <syg-label>Allow Navigation</syg-label>
        <syg-radio value="allow"></syg-radio>
      </syg-item>

      <syg-item>
        <syg-label>Block Navigation</syg-label>
        <syg-radio value="block"></syg-radio>
      </syg-item>

      <syg-item>
        <syg-label>Redirect</syg-label>
        <syg-radio value="redirect"></syg-radio>
      </syg-item>
    </syg-radio-group>
  </div>

  <syg-app>

    <syg-router>
      <syg-route-redirect from="/" to="/home"></syg-route-redirect>
      <syg-route url="/home" component="home-page"></syg-route>
      <syg-route url="/test" component="test-page"></syg-route>
      <syg-route url="/child/:id" component="child-page"></syg-route>
      <syg-route url="/guard-initial-page" component="guard-initial-page"></syg-route>
    </syg-router>

    <syg-nav></syg-nav>

    <script>
      const beforeEnterGroup = document.querySelector('syg-radio-group#beforeEnter');
      const beforeLeaveGroup = document.querySelector('syg-radio-group#beforeLeave');
      beforeEnterGroup.addEventListener('ionChange', (ev) => {
        switch (ev.detail.value) {
          case "redirect":
            page.beforeEnter = redirect;
            break;
          case "block":
            page.beforeEnter = block;
            break;
          default:
            page.beforeEnter = allow;
            break;
        }
      });

      beforeLeaveGroup.addEventListener('ionChange', (ev) => {
        switch (ev.detail.value) {
          case "redirect":
          page.beforeLeave = redirect;
          break;
          case "block":
          page.beforeLeave = block;
          break;
          default:
          page.beforeLeave = allow;
          break;
        }
      });

      const redirect = (to = '/test') => { return { redirect: to }};
      const block = () => false;
      const allow = () => true;

      const page = document.querySelector('syg-route[component="child-page"]');
      page.beforeEnter = allow;
      page.beforeLeave = allow;


      const guardPage = document.querySelector('syg-route[component="guard-initial-page"]');
      guardPage.beforeEnter = () => {
        return { redirect: '/child/1' };
      }
    </script>
  </syg-app>
</body>
</html>
